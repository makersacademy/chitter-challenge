<!DOCTYPE html>

<html>

  <head>
    <meta charset="UTF-8">
    <title>Chitter</title>
    <link href="/css/stylesheet.css" type="text/css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet">
  </head>

  <body>
  <div id="top_bar">
    <table id="top_bar_table">
      <tr>
        <td>
  <% if current_user %>
              <p class="greeting"><%= greeting(current_user) %></p>
              <td id="right_side">
                <div class="dropdown">
                  <button class="dropbtn"><img src="<%= current_user.picture_url %>" id="top_right_profile_pic"></button>
                  <div class="dropdown-content">
                    <a href="/">Home</a>
                    <a href="/peep">Peep</a>
                    <a href="#">Profile</a>
                    <a href="#">Settings</a>
                    <a href="/logout">Logout</a>
                  </div>
                </div>
              </td>
  <% else %>
      <form action='/login' method='post'>
          <label for='username'>
            <input class="text_input" type='text' name='username' placeholder='Username'>
          </label>
          <label for='password'>
            <input class="text_input" type='password' name='password' placeholder='Password'>
          </label>
        <input type="submit" value="Login" class="submit_button">
      </form>
        </td>
        <td id="right_side">
          <form action="/sign_up" method="get">
            <input type="submit" value="Sign Up" id="sign_up_button">
          </form>
        </td>
  <% end %>
      </tr>
    </table>
  </div>


  <div id="chitter_feed">
    <ul id='links'>
      <% @peeps.reverse.each do |peep| %>
        <% hashtags = [] %>
        <% body = peep.body.delete(',.?!;:') %>
        <% body.split.each { |word| hashtags << word if word[0] == '#' } %>
        <% hashtags.each { |word| peep.body.gsub!(word, "<a href='peeps/#{word.delete('#')}' class='hashtag'>#{word}</a>") } %>
        <% user = User.get(peep.user_id) %>
        <li class="peep">
          <table>
            <tr>
              <td><img src="<%= user.picture_url %>" class="user_picture"></td>
              <td>
                <p><span class="name"><%= "#{user.first_name} #{user.last_name} " %></span><a href="users/<%= user.username %>" class="username"><%= "@#{user.username} " %></a><span><%= "- #{peep_datetime(peep.time)}" %></span></p>
                "<%= peep.body %>"
                <a href="/like/<%= peep.id %>"><div class="likes_div"><img src="http://michael-jacobson.co.uk/red_heart.png" class="heart_image"><%= peep.likes %></div></a>
              </td>
            </tr>
          </table>
        </li><br>
      <% end %>
    </ul>
  </div>

  </body>

</html>
