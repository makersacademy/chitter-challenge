# Peeps Model and Repository Classes Design Recipe

## 1. Design and create the Table

schema/peeps_users_tables.sql
```
Table: peeps

Columns:
id | content | datetime | user_id
```

## 2. Create Test SQL seeds

schema/peeps_users_seeds.sql

## 3. Define the class names

```ruby
# Table name: peeps

# Model class
# (in lib/peep.rb)
class Peep
end

# Repository class
# (in lib/peep_repository.rb)
class PeepRepository
end
```

## 4. Implement the Model class

```ruby
# Table name: peeps

# Model class
# (in lib/peep.rb)

class Peep
  attr_accessor :id, :content, :datetime, :user_id
end
```

## 5. Define the Repository Class interface

```ruby
# Table name: peeps

# Repository class
# (in lib/peep_repository.rb)

class PeepRepository

  # Selecting all records
  # No arguments
  def all_peeps
    # Executes the SQL query:
    # SELECT * FROM peeps;

    # Returns an array of peep objects.
  end

  # Gets a single record by its ID
  # One argument: the id (number)
  def find_peep(id)
    # Executes the SQL query:
    # SELECT * FROM peeps WHERE id = $1;

    # Returns a single Peep object.
  end

  def create_peep(peep)
    # Peep object will have attributes filled for content and user_id
    # datetime will be generated by psql automatically
    # user_id will be filled by using the user model class that shows who's logged in

    # Executes the SQL query:
    # INSERT INTO peeps (content, user_id) VALUES($1, $2)
  end

  # def edit_peep(peep)
  # end

  # def delete_peep(peep)
  # end
end
```

## 6. Write Test Examples

```ruby

# 1
# Get all peeps

peeps = @repo.all_peeps

peeps.length # =>  6

peeps[0].id # =>  '1'
peeps[0].content # =>  'Just set up my chitter'
peeps[0].user_id # =>  '1'

peeps[1].id # =>  '2'
peeps[1].name # =>  'RIP Uncle Phil'
peeps[1].user_id # =>  '2'

# 2
# Get a single peep

peep = @repo.find_peep(2)

peep.id # =>  '3'
peep.name # =>  'OMDs J.cole just joined chitter!'
peep.user_id # =>  '1'

# 3
# Create a peep

new_peep = Peep.new
new_peep.content = "Should I acquire twitter?"
new_peep.user_id = 1

@repo.create_peep(new_peep)
peeps = @repo.all_peeps
peeps[-1].content # => "Should I acquire twitter?"

```

Encode this example as a test.

## 7. Reload the SQL seeds before each test run

```ruby

# file: spec/peep_repository_spec.rb

def reset_peeps_users_tables
  seed_sql = File.read('spec/peeps_users_tables.sql')
  connection = PG.connect({ host: '127.0.0.1', dbname: 'chitter_test' })
  connection.exec(seed_sql)
end

describe PeepRepository do
  before do 
    reset_peeps_users_tables
    @repo = PeepRepository.new
  end

  # (your tests will go here).
end
```

## 8. Test-drive and implement the Repository class behaviour

_After each test you write, follow the test-driving process of red, green, refactor to implement the behaviour._
